@startuml
title CUST5 - Pay for a Tour (via Stripe)

skinparam backgroundColor #F5F5DC
hide footbox

actor Customer #F5F5DC
participant "Travel Management System" as TMS #FFFFFF
participant "Stripe" as Stripe #FFFFFF

' 1) Customer starts payment process
Customer -> TMS : 1. PayForBooking()

' 2) TMS creates a Stripe checkout session
TMS -> Stripe : 2. createCheckoutSession()
Stripe -> TMS : 3. Return session info (sessionId)

' 3) TMS returns a checkout URL or session ID to Customer
TMS -> Customer : 4. Provide Stripe checkout link

' 4) Customer is redirected to Stripe for payment
Customer -> Stripe : 5. [Redirected to Stripe Checkout Page]
Stripe -> Customer : 6. [Displays payment UI]
Customer -> Stripe : 6a. Fills out payment details (card information)

' 5) Payment outcome and webhook callback
alt Payment Completed
    Stripe -> TMS : 7. Webhook: checkout.session.completed
    TMS -> TMS : 8. confirmBookingPayment(bookingId)
    TMS -> Customer : 9. Payment confirmation (updated booking to PAYMENT_COMPLETED)
    TMS -> Customer : 10. Redirected to 'Success' page URL
else Payment Failed or Canceled
    Stripe -> TMS : 7a. Webhook: payment_intent.payment_failed OR checkout cancelled
    TMS -> Customer : 8a. Error / Payment Failed message
    TMS -> Customer : 9a. Redirected to 'Cancelled' page URL

end

@enduml
